<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>qdtsne: C++ library for t-SNE</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">qdtsne
   </div>
   <div id="projectbrief">A quick and dirty t-SNE C++ library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">C++ library for t-SNE </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__2github_2workspace_2README"></a> <img src="https://github.com/libscran/qdtsne/actions/workflows/run-tests.yaml/badge.svg" alt="Unit tests" style="pointer-events: none;" class="inline"/> <img src="https://github.com/libscran/qdtsne/actions/workflows/doxygenate.yaml/badge.svg" alt="Documentation" style="pointer-events: none;" class="inline"/> <img src="https://github.com/libscran/qdtsne/actions/workflows/compare-Rtsne.yaml/badge.svg" alt="Rtsne comparison" style="pointer-events: none;" class="inline"/> <a href="https://codecov.io/gh/libscran/qdtsne"><img src="https://codecov.io/gh/libscran/qdtsne/branch/master/graph/badge.svg?token=CX6G39BM7B" alt="Codecov" style="pointer-events: none;" class="inline"/></a></p>
<h1>Overview</h1>
<p>This repository contains a header-only C++ library implementing the Barnes-Hut t-distributed stochastic neighbor embedding (t-SNE) algorithm (van der Maaten and Hinton, 2008; van der Maaten, 2014). t-SNE is a non-linear dimensionality reduction technique that enables visualization of complex datasets by placing each observation on a low-dimensional (usually 2D) map based on its neighbors. The general idea is that neighboring observations are placed next to each other, thus preserving the local structure of the dataset from its original high-dimensional form. The non-linear nature of the algorithm gives it the flexibility to accommodate complicated structure that is not possible in linear techniques like PCA.</p>
<p>The code here is derived from the C++ code in the <a href="https://github.com/jkrijthe/Rtsne/"><b>Rtsne</b> R package</a>, itself taken from the 2014 paper. It has been updated to use more modern C++, along with some additional options to sacrifice accuracy for speed - see below for details.</p>
<h1>Quick start</h1>
<p>Using this library is as simple as including the header file in your source code:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="qdtsne_8hpp.html">qdtsne/qdtsne.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Assuming `data` contains high-dimensional data in column-major format,</span></div>
<div class="line"><span class="comment">// i.e., each column is a observation and each row is a dimension. We </span></div>
<div class="line"><span class="comment">// initialize the t-SNE algorithm for a 2-dimensional embedding.</span></div>
<div class="line"><a class="code hl_struct" href="structqdtsne_1_1Options.html">qdtsne::Options</a> opt;</div>
<div class="line"><span class="keyword">auto</span> status = <a class="code hl_class" href="classqdtsne_1_1Status.html">qdtsne::initialize&lt;2&gt;</a>(nrow, ncol, data.data(), knncolle::VptreeBuilder(), opt);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Starting the t-SNE algorithm from random 2-dimensional coordinates.</span></div>
<div class="line"><span class="keyword">auto</span> Y = <a class="code hl_class" href="classqdtsne_1_1Status.html">qdtsne::initialize_random&lt;2&gt;</a>(ncol); </div>
<div class="line">status.run(Y.data());</div>
<div class="ttc" id="aclassqdtsne_1_1Status_html"><div class="ttname"><a href="classqdtsne_1_1Status.html">qdtsne::Status</a></div><div class="ttdoc">Current status of the t-SNE iterations.</div><div class="ttdef"><b>Definition</b> Status.hpp:64</div></div>
<div class="ttc" id="aqdtsne_8hpp_html"><div class="ttname"><a href="qdtsne_8hpp.html">qdtsne.hpp</a></div><div class="ttdoc">Umbrella header for all qdtsne files.</div></div>
<div class="ttc" id="astructqdtsne_1_1Options_html"><div class="ttname"><a href="structqdtsne_1_1Options.html">qdtsne::Options</a></div><div class="ttdef"><b>Definition</b> Options.hpp:15</div></div>
</div><!-- fragment --><p>You can change the parameters with the relevant setters:</p>
<div class="fragment"><div class="line">opt.<a class="code hl_variable" href="structqdtsne_1_1Options.html#ae485ba64f2ff5379f09a75fb89447628">perplexity</a> = 10;</div>
<div class="line">opt.<a class="code hl_variable" href="structqdtsne_1_1Options.html#a0efc1892882f473e5e38e5ab11d5d604">mom_switch_iter</a> = 100;</div>
<div class="ttc" id="astructqdtsne_1_1Options_html_a0efc1892882f473e5e38e5ab11d5d604"><div class="ttname"><a href="structqdtsne_1_1Options.html#a0efc1892882f473e5e38e5ab11d5d604">qdtsne::Options::mom_switch_iter</a></div><div class="ttdeci">int mom_switch_iter</div><div class="ttdef"><b>Definition</b> Options.hpp:63</div></div>
<div class="ttc" id="astructqdtsne_1_1Options_html_ae485ba64f2ff5379f09a75fb89447628"><div class="ttname"><a href="structqdtsne_1_1Options.html#ae485ba64f2ff5379f09a75fb89447628">qdtsne::Options::perplexity</a></div><div class="ttdeci">double perplexity</div><div class="ttdef"><b>Definition</b> Options.hpp:23</div></div>
</div><!-- fragment --><p>You can also stop and start the algorithm:</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> status2 = <a class="code hl_function" href="namespaceqdtsne.html#ad8a5142687a23b674abed584613d92b0">qdtsne::initialize</a>(nrow, ncol, data.data(), knncolle::VptreeBuilder(), opt);</div>
<div class="line">status2.run(Y.data(), 200); <span class="comment">// run up to 200 iterations</span></div>
<div class="line">status2.run(Y.data(), 500); <span class="comment">// run up to 500 iterations</span></div>
<div class="ttc" id="anamespaceqdtsne_html_ad8a5142687a23b674abed584613d92b0"><div class="ttname"><a href="namespaceqdtsne.html#ad8a5142687a23b674abed584613d92b0">qdtsne::initialize</a></div><div class="ttdeci">Status&lt; ndim_, Index_, Float_ &gt; initialize(NeighborList&lt; Index_, Float_ &gt; neighbors, const Options &amp;options)</div><div class="ttdef"><b>Definition</b> initialize.hpp:85</div></div>
</div><!-- fragment --><p>See the <a href="https://libscran.github.io/qdtsne/">reference documentation</a> for more details.</p>
<h1>Approximations for speed</h1>
<p>van der Maaten (2014) proposed the use of the Barnes-Hut approximation for the repulsive force calculations in t-SNE. The algorithm consolidates a group of distant points into a single center of mass, avoiding the need to calculate forces between individual points. The definition of "distant" is determined by the <code>theta</code> parameter, where larger values sacrifice accuracy for speed.</p>
<p>In <b>qdtsne</b>, we introduce an extra <code>max_depth</code> parameter that bounds the depth of the tree used for the Barnes-Hut force calculations. Setting a maximum depth of $m$ is equivalent to the following procedure:</p>
<ol type="1">
<li>Define the bounding box/hypercube for our dataset and partition it along each dimension into $2^m$ intervals, forming a high-dimensional grid.</li>
<li>In each grid cell, move all data points in that cell to the cell's center of mass.</li>
<li>Construct a standard Barnes-Hut tree (without any maximum depth limits) on this modified dataset.</li>
<li>Use the tree to compute repulsive forces for each (unmodified) point $i$ from the original dataset.</li>
</ol>
<p>The approximation is based on ignoring the distribution within each grid cell, which is probably acceptable for very small intervals with large $m$. Smaller values of $m$ reduce computational time by limiting the depth of the recursion, at the cost of approximation quality for the repulsive force calculation. A value of 7 to 10 seems to be a good compromise for most applications.</p>
<p>We can go even further by using the center of mass for $i$'s leaf node to approximate $i$'s repulsive forces with all other leaf nodes. We can thus compute the repulsive forces once per leaf node, and then re-use those values for all points assigned to the same node. This eliminates near-redundant searches through the tree for each point $i$, with the only extra calculation being the repulsion between $i$ and its own leaf node. We call this approach the "leaf approximation", which is enabled through the <code>leaf_approximation</code> parameter. Note that this only has an effect in <code>max_depth</code>-bounded trees where multiple points are assigned to a leaf node.</p>
<p>Some testing indicates that both approximations can significantly speed up calculation of the embeddings. Timings are shown below in seconds, based on a mock dataset containing 50,000 points (see <a href="tests/R/examples/basic.R"><code>tests/R/examples/basic.R</code></a> for details).</p>
<p>|-&mdash;|-&mdash;|&mdash;| </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Strategy   </th><th class="markdownTableHeadNone">Serial   </th><th class="markdownTableHeadNone">Parallel (OpenMP, n = 4)    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Default   </td><td class="markdownTableBodyNone">136   </td><td class="markdownTableBodyNone">42    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>max_depth = 7</code>   </td><td class="markdownTableBodyNone">85   </td><td class="markdownTableBodyNone">26    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>max_depth = 7</code>, <code>leaf_approximation = true</code>   </td><td class="markdownTableBodyNone">46   </td><td class="markdownTableBodyNone">16   </td></tr>
</table>
<h1>Building projects</h1>
<h2>CMake with <code>FetchContent</code></h2>
<p>If you're already using CMake, you can add something like this to your <code>CMakeLists.txt</code>:</p>
<div class="fragment"><div class="line">include(FetchContent)</div>
<div class="line"> </div>
<div class="line">FetchContent_Declare(</div>
<div class="line">  qdtsne </div>
<div class="line">  GIT_REPOSITORY https://github.com/libscran/qdtsne</div>
<div class="line">  GIT_TAG master # or any version of interest</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">FetchContent_MakeAvailable(qdtsne)</div>
</div><!-- fragment --><p>And then:</p>
<div class="fragment"><div class="line"># For executables:</div>
<div class="line">target_link_libraries(myexe qdtsne)</div>
<div class="line"> </div>
<div class="line"># For libaries</div>
<div class="line">target_link_libraries(mylib INTERFACE qdtsne)</div>
</div><!-- fragment --><h2>CMake with <code>find_package()</code></h2>
<div class="fragment"><div class="line">find_package(libscran_qdtsne CONFIG REQUIRED)</div>
<div class="line">target_link_libraries(mylib INTERFACE libscran::qdtsne)</div>
</div><!-- fragment --><p>To install the library, use:</p>
<div class="fragment"><div class="line">mkdir build &amp;&amp; cd build</div>
<div class="line">cmake .. -DQDTSNE_TESTS=OFF</div>
<div class="line">cmake --build . --target install</div>
</div><!-- fragment --><p>By default, this will use <code>FetchContent</code> to fetch all external dependencies. If you want to install them manually, use <code>-DQDTSNE_FETCH_EXTERN=OFF</code>. See <a href="extern/CMakeLists.txt"><code>extern/CMakeLists.txt</code></a> to find compatible versions of each dependency.</p>
<h2>Manual</h2>
<p>If you're not using CMake, you can just copy the header files in <code>include/</code> into some location that is visible to your compiler. This requires the manual inclusion of the dependencies listed in <a href="extern/CMakeLists.txt"><code>extern/CMakeLists.txt</code></a>.</p>
<h1>References</h1>
<p>van der Maaten, L.J.P. and Hinton, G.E. (2008). Visualizing high-dimensional data using t-SNE. <em>Journal of Machine Learning Research</em>, 9, 2579-2605.</p>
<p>van der Maaten, L.J.P. (2014). Accelerating t-SNE using tree-based algorithms. <em>Journal of Machine Learning Research</em>, 15, 3221-3245. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
